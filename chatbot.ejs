<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous"> -->

    <title>Chat - Ask me Anything</title>
    <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@600&display=swap" rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
        rel="stylesheet" />
    <link rel="icon" href="/images/logo/Logo.png" type="image/x-icon">
    <link rel="stylesheet" href="styles/chatbot.css">
  </head>
  <body>
    <!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Navigation Bar</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@600&display=swap" rel="stylesheet">
</head>

<body>
  
    

    

    
    <div class="main">
      <nav class="navbar">
        <div class="navbar-left">
            <div class="logo"> <img src="images/img/bed66fc55b7dcc5eb23bf385bdf7401a.png" style="width: 30px; height: 30px; border-radius: 50%;" alt=""> </div>
            <div class="nav-logo" style="font-family: 'Caveat'; font-size: 24px;">MindWise</div>
            <div class="nav-item"><a href="/home">Home</a></div>
            <div class="nav-item"><a href="">Explore</a></div>
            <div class="nav-item"><a href="">Service</a></div>
            <div class="nav-item"><a href="">Analytics</a></div>
        </div>
        <div class="navbar-right">
            <div class="search-bar"><input type="search" placeholder="Search" name="Seacrch" id="search-area"><i class="fa-solid fa-magnifying-glass"></i></div>
            <div class="notification-icon"><i class="fa-solid fa-bell" style="margin-right: 10px;"></i></div>
            <div class="profile-icon"><img src="images/img/bed66fc55b7dcc5eb23bf385bdf7401a.png" alt=""></div>
        </div>
    </nav>
    <hr>
      <div class="chat-container chats">
          <!-- <div class="chat outgoing">
              <div class="chat-content">
                  <div class="chat-details">
                      <img src="Logo.png" alt="user-img">
                      <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Porro, qui.</p>
                  </div>
              </div>
          </div>
          <div class="chat incoming">
              <div class="chat-content">
                  <div class="chat-details">
                      <img src="Logo.png" alt="user-img">
                      <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Porro, qui.</p>
                      <span class="material-symbols-rounded">content_copy</span>
                  </div>
              </div>
          </div>
 -->
        <div class="chat-content">
          <div class="chat-details">
            <!-- <div class="typing-dot" style="--delay:0.2s"></div>
            <div class="typing-dot" style="--delay:0.3s"></div>
            <div class="typing-dot" style="--delay:0.4s"></div> -->
          </div>
        </div>
      </div>
      <div class="typing-container">
          <div class="typing-content">
              <div class="typing-textarea">
                  <textarea name="search" id="chat-input" placeholder="Enter a prompt here" required></textarea>
                  <span id="send-btn" class="material-symbols-rounded">send</span>
              </div>

              <div class="typing-controls">

                  <span id="mic-btn" class="material-symbols-rounded">mic</span>
                  <span id="delete-btn" class="material-symbols-rounded">delete</span>
              </div>
          </div>
      </div>
    </div>


    </div>



    <!-- <script>
      const inputBox = document.getElementById('input-box');
      const voiceIcon = document.getElementById('voice-icon');

      // Function to handle voice input
      function startVoiceInput() {
        // Code to start voice input
        inputBox.placeholder = "Listening...";
        // Simulating voice input
        setTimeout(() => {
          const voiceInputText = "This is a voice input";
          inputBox.value = voiceInputText;
          inputBox.placeholder = "Type or speak";
        }, 2000); // Simulating voice recognition delay
      }

      // Event listener for clicking on the microphone icon
      voiceIcon.addEventListener('click', startVoiceInput);
    </script>
 -->

    <script src="https://kit.fontawesome.com/abbae87c93.js" crossorigin="anonymous"></script>
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>



<script>
  async function postData(url = "", data = {}) {
 
    const response = await fetch(url, {
      method: "POST", 
      mode: "cors", 
      cache: "no-cache", 
      credentials: "same-origin", 
      headers: {
        "Content-Type": "application/json",

      },
      redirect: "follow", 
      referrerPolicy: "no-referrer", 
      body: JSON.stringify(data), 
    });
    return response.json(); 
  }
  const populateusingGPT = (input)=>{
    postData("/api", { input: input }).then((data) => {
    document.querySelector(".chats").innerHTML = 
      document.querySelector(".chats").innerHTML + `
          <div class="chat incoming">
              <div class="chat-content">
                  <div class="chat-details">
                    
                      <p>Answer:<span class="que">${data.message}</span></p>
                      <!-- <span class="material-symbols-rounded">content_copy</span> -->
                  </div>
              </div>
          </div>` 
      });
  }
  let speech = false;
  let globalTranscript;
  window.SpeechRecognition = window.SpeechRecognition
    || window.webkitSpeechRecognition;

  const recognition = new SpeechRecognition();
  recognition.interimResults = true;

  
  recognition.addEventListener('result', e => {
    const transcript = Array.from(e.results)
      .map(result => result[0])
      .map(result => result.transcript)
      .join('')

    globalTranscript = transcript 
  });
  const chatInput = document.querySelector("#chat-input");
  const sendButton = document.querySelector("#send-btn");
  const micButton = document.querySelector("#mic-btn");

  micButton.addEventListener("click", ()=>
    {
      speech=true;
      if(speech==true)
      {
      recognition.start();
      recognition.addEventListener('end', ()=>
      {
        console.log(globalTranscript);   

        if(globalTranscript!=="")
        {
          document.querySelector(".chats").innerHTML = 
          document.querySelector(".chats").innerHTML + ` <div class="chat outgoing">
                  <div class="chat-content">
                      <div class="chat-details">
                          <p>Question:<span class="que">
   ${globalTranscript}</span></p>
                      </div>
                  </div>
              </div>`;
        populateusingGPT(globalTranscript)
        }
        globalTranscript=""

      });

      }

    })
 
  let userText=null;
  sendButton.addEventListener("click", ()=>
    {
      speech=false;
      userText=chatInput.value.trim();
      if(speech==false){
        console.log(userText);
        if(userText!=="")
        {
          chatInput.value="";
          document.querySelector(".chats").innerHTML = 
          document.querySelector(".chats").innerHTML + ` <div class="chat outgoing">
                  <div class="chat-content">
                      <div class="chat-details">
                          <p>Question:<span class="que">${userText}</span></p>
                      </div>
                  </div>
              </div>`;
           populateusingGPT(userText)
        }
        userText=""
      }
      
    })

</script>

  </body>
</html>